(function(e){function t(t){for(var r,o,l=t[0],s=t[1],c=t[2],d=0,f=[];d<l.length;d++)o=l[d],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&f.push(n[o][0]),n[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,l=1;l<a.length;l++){var s=a[l];0!==n[s]&&(r=!1)}r&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var r={},n={app:0},i=[];function o(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=r,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(a,r,function(t){return e[t]}.bind(null,r));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var r=a("85ec"),n=a.n(r);n.a},"06dc":function(e,t,a){"use strict";a.r(t),a.d(t,"GetArrayBuffer",(function(){return n})),a.d(t,"GetFileInfo",(function(){return l})),a.d(t,"GetCoverURL",(function(){return s})),a.d(t,"AudioMimeType",(function(){return o}));a("e260"),a("e6cf"),a("1276"),a("498a"),a("ddb0"),a("2b3d");var r=a("1da1");function n(e){return i.apply(this,arguments)}function i(){return i=Object(r["a"])((function*(e){return yield new Promise(t=>{var a=new FileReader;a.onload=e=>{t(e.target.result)},a.readAsArrayBuffer(e)})})),i.apply(this,arguments)}var o={mp3:"audio/mpeg",flac:"audio/flac",m4a:"audio/mp4",ogg:"audio/ogg"};function l(e,t,a,r){var n="",i="",o=a.split("-");o.length>1?(n=o[0].trim(),i=o[1].trim()):1===o.length&&(i=o[0].trim()),"string"==typeof e&&""!==e&&(n=e),"string"==typeof t&&""!==t&&(i=t);var l=n+" - "+i+"."+r;return{artist:n,title:i,filename:l}}function s(e){var t="";if(void 0!==e.common.picture&&e.common.picture.length>0){var a=new Blob([e.common.picture[0].data],{type:e.common.picture[0].format});t=URL.createObjectURL(a)}return t}},1:function(e,t){},2:function(e,t){},"56d7":function(e,t,a){"use strict";a.r(t);var r=a("2b0e"),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("el-container",[a("el-main",[a("el-upload",{attrs:{"auto-upload":!1,"on-change":e.handleFile,"show-file-list":!1,action:"",drag:"",multiple:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击选择")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("本工具仅在浏览器内对文件进行解锁，无需消耗流量")])]),a("el-row",{attrs:{id:"app-control"}},[a("el-row",{staticStyle:{"padding-bottom":"1em","font-size":"14px"}},[e._v(" 歌曲命名格式： "),a("el-radio",{attrs:{name:"format",label:"1"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌曲名")]),a("el-radio",{attrs:{name:"format",label:"2"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌手-歌曲名")]),a("el-radio",{attrs:{name:"format",label:"3"},model:{value:e.format,callback:function(t){e.format=t},expression:"format"}},[e._v("歌曲名-歌手")]),a("el-checkbox",{attrs:{border:""},model:{value:e.instantDownload,callback:function(t){e.instantDownload=t},expression:"instantDownload"}},[e._v("立即保存")])],1),a("el-button",{attrs:{icon:"el-icon-download",plain:""},on:{click:e.handleDownloadAll}},[e._v("下载全部")]),a("el-button",{attrs:{icon:"el-icon-delete",plain:"",type:"danger"},on:{click:e.handleDeleteAll}},[e._v("删除全部")])],1),a("audio",{attrs:{autoplay:e.playing_auto,src:e.playing_url,controls:""}}),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[a("el-table-column",{attrs:{label:"封面"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:t.row.picture}},[a("div",{staticClass:"image-slot el-image__error",attrs:{slot:"error"},slot:"error"},[e._v(" 暂无封面 ")])])]}}])}),a("el-table-column",{attrs:{label:"歌曲",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.title))])]}}])}),a("el-table-column",{attrs:{label:"歌手",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.artist))])]}}])}),a("el-table-column",{attrs:{label:"专辑",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.album))])]}}])}),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{circle:"",icon:"el-icon-video-play",type:"success"},on:{click:function(a){return e.handlePlay(t.$index,t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-download"},on:{click:function(a){return e.handleDownload(t.row)}}}),a("el-button",{attrs:{circle:"",icon:"el-icon-delete",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}})]}}])})],1)],1),a("el-footer",{attrs:{id:"app-footer"}},[a("el-row",[e._v(" 音乐解锁：移除已购音乐的加密保护。 目前支持网易云音乐(ncm)、QQ音乐(qmc, mflac, tkm)以及 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/README.md",target:"_blank"}},[e._v("其他格式")]),e._v("。 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/wiki/使用提示",target:"_blank"}},[e._v("使用提示")])]),a("el-row",[a("span",[e._v("Copyright © 2019")]),a("a",{attrs:{href:"https://github.com/ix64",target:"_blank"}},[e._v("MengYX")]),e._v(" 音乐解锁使用 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music/blob/master/LICENSE",target:"_blank"}},[e._v("MIT许可协议")]),e._v(" 开放 "),a("a",{attrs:{href:"https://github.com/ix64/unlock-music",target:"_blank"}},[e._v("源代码")])])],1)],1)],1)},i=[],o=(a("e260"),a("a434"),a("ddb0"),a("2b3d"),a("bfa2")),l=a("bd2e"),s={name:"app",components:{},data(){return{activeIndex:"1",tableData:[],playing_url:"",playing_auto:!1,format:"2",instantDownload:!1,workCount:0,cacheQueue:[],cacheQueueOption:{push:e=>{this.cacheQueue.push(e)},pop:()=>this.cacheQueue.shift(),size:()=>this.cacheQueue.length},workers:[],idle_workers:[],thread_num:1}},mounted(){if(this.$nextTick((function(){this.finishLoad()})),""!==document.location.host){this.thread_num=Math.max(navigator.hardwareConcurrency,1);for(var e=0;e<this.thread_num;e++)this.workers.push(o().CommonDecrypt),this.idle_workers.push(e)}else this.workers.push(l.CommonDecrypt),this.idle_workers.push(0)},methods:{finishLoad(){document.getElementById("loader-mask").remove(),this.$notify.info({title:"离线使用",message:'我们使用PWA技术，无网络也能使用<br/>最近更新：支持bkcmp3/bkcflac/tkm<br/>点击查看 <a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:1e4,position:"top-left"})},handleFile(e){this.idle_workers.length>0?this.handleDoFile(e,this.idle_workers.shift()):this.cacheQueueOption.push(e)},handleCacheQueue(e){0!==this.cacheQueue.length?this.handleDoFile(this.cacheQueueOption.pop(),e):this.idle_workers.push(e)},handleDoFile(e,t){this.workers[t](e).then(a=>{if(a.status){this.instantDownload?(this.handleDownload(a),this.handleDelete(null,a)):(this.tableData.push(a),this.$notify.success({title:"解锁成功",message:"成功解锁 "+a.title,duration:3e3}));var r=[a.title,a.artist,a.album];window._paq.push(["trackEvent","Unlock",a.rawExt+","+a.mime,JSON.stringify(r)])}else this.$notify.error({title:"出现问题",message:a.message+"，"+e.name+'，参考<a target="_blank" href="https://github.com/ix64/unlock-music/wiki/使用提示">使用提示</a>',dangerouslyUseHTMLString:!0,duration:6e3}),window._paq.push(["trackEvent","Error",a.message,e.name]);this.handleCacheQueue(t)}).catch(a=>{console.error(a,e),window._paq.push(["trackEvent","Error",a,e.name]),this.handleCacheQueue(t)})},handlePlay(e,t){this.playing_url=t.file,this.playing_auto=!0},handleDelete(e,t){URL.revokeObjectURL(t.file),URL.revokeObjectURL(t.picture),null!=e&&this.tableData.splice(e,1)},handleDownload(e){var t=document.createElement("a");switch(t.href=e.file,this.format){case"1":t.download=e.title+"."+e.ext;break;case"2":t.download=e.artist+" - "+e.title+"."+e.ext;break;case"3":t.download=e.title+" - "+e.artist+"."+e.ext;break;default:t.download=e.filename;break}document.body.append(t),t.click(),t.remove()},handleDeleteAll(){this.tableData.forEach(e=>{URL.revokeObjectURL(e.file),URL.revokeObjectURL(e.picture)}),this.tableData=[]},handleDownloadAll(){var e=0,t=setInterval(()=>{e<this.tableData.length?(this.handleDownload(this.tableData[e]),e++):clearInterval(t)},1e3)}}},c=s,u=(a("034f"),a("2877")),d=Object(u["a"])(c,n,i,!1,null,null,null),f=d.exports,m=a("9483");Object(m["a"])("".concat("","service-worker.js"),{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var p=a("5c96");a("0fae");r["default"].use(p["Link"]),r["default"].use(p["Image"]),r["default"].use(p["Button"]),r["default"].use(p["Table"]),r["default"].use(p["TableColumn"]),r["default"].use(p["Main"]),r["default"].use(p["Footer"]),r["default"].use(p["Container"]),r["default"].use(p["Icon"]),r["default"].use(p["Row"]),r["default"].use(p["Col"]),r["default"].use(p["Upload"]),r["default"].use(p["Checkbox"]),r["default"].use(p["Radio"]),r["default"].prototype.$notify=p["Notification"],r["default"].config.productionTip=!1,new r["default"]({render:e=>e(f)}).$mount("#app")},"7cc0":function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return l}));a("e260"),a("fb6a"),a("ace4"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("ade3"),n=a("1da1"),i=a("cb96"),o=a("06dc");function l(e,t,a){return s.apply(this,arguments)}function s(){return s=Object(n["a"])((function*(e,t,a){if("mflac"!==a)return{status:!1,message:"File type is incorrect!"};var r=yield o.GetArrayBuffer(e),n=new Uint8Array(r.slice(0,-368)),l=n.length,s=new c;if(!s.DetectMask(n))return{status:!1,message:"此音乐无法解锁，目前mflac格式不提供完整支持"};for(var u=0;u<l;++u)n[u]^=s.NextMask();var d=new Blob([n],{type:"audio/flac"}),f=URL.createObjectURL(d),m=yield i.parseBlob(d),p=o.GetFileInfo(m.common.artist,m.common.title,t,"flac"),h=o.GetCoverURL(m);return{status:!0,filename:p.filename,title:p.title,artist:p.artist,ext:"flac",album:m.common.album,picture:h,file:f,mime:"audio/flac"}})),s.apply(this,arguments)}class c{constructor(){Object(r["a"])(this,"FLAC_HEADER",[102,76,97,67,0]),this.index=-1,this.mask_index=-1,this.mask=Array(128).fill(0)}DetectMask(e){for(var t,a=e.length-256,r=0;r<a;r+=128){var n=!0;t=e.slice(r,r+128);for(var i=e.slice(r+128,r+256),o=0;o<128;o++)if(t[o]!==i[o]){n=!1;break}if(n){for(var l=0;l<this.FLAC_HEADER.length;l++){var s=e[l]^t[l];if(s!==this.FLAC_HEADER[l]){n=!1;break}}if(n)return this.mask=t,!0}}return!1}NextMask(){return this.index++,this.mask_index++,(32768===this.index||this.index>32768&&(this.index+1)%32768===0)&&(this.index++,this.mask_index++),this.mask_index>=128&&(this.mask_index-=128),this.mask[this.mask_index]}}},"85ec":function(e,t,a){},a8ee:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return l}));a("e260"),a("ace4"),a("5cc6"),a("b39a");var r=a("1da1"),n=a("fd2f"),i=a("06dc"),o=[0,0,0,32,102,116,121,112];function l(e,t){return s.apply(this,arguments)}function s(){return s=Object(r["a"])((function*(e,t){for(var a=yield i.GetArrayBuffer(e),r=new Uint8Array(a),l=0;l<8;++l)r[l]=o[l];var s=new Blob([r],{type:"audio/mp4"});return yield n.Decrypt(s,t,"m4a")})),s.apply(this,arguments)}},b6cf:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return s}));a("e260"),a("ace4"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("cb96"),i=a("06dc"),o=[[74,214,202,144,103,247,82],[94,149,35,159,19,17,126],[71,116,61,144,170,63,81],[198,9,213,159,250,102,249],[243,214,161,144,160,247,240],[29,149,222,159,132,17,244],[14,116,187,144,188,63,146],[0,9,91,159,98,102,161]],l={qmc0:"mp3",qmc3:"mp3",qmcogg:"ogg",qmcflac:"flac",bkcmp3:"mp3",bkcflac:"flac",tkm:"m4a"};function s(e,t,a){return c.apply(this,arguments)}function c(){return c=Object(r["a"])((function*(e,t,a){if(!(a in l))return{status:!1,message:"File type is incorrect!"};for(var r=l[a],o=i.AudioMimeType[r],s=yield i.GetArrayBuffer(e),c=new Uint8Array(s),d=new u,f=0;f<c.length;++f)c[f]^=d.NextMask();var m=new Blob([c],{type:o}),p=URL.createObjectURL(m),h=yield n.parseBlob(m),b=i.GetFileInfo(h.common.artist,h.common.title,t,r),y=i.GetCoverURL(h);return{status:!0,filename:b.filename,title:b.title,artist:b.artist,ext:r,album:h.common.album,picture:y,file:p,mime:o}})),c.apply(this,arguments)}class u{constructor(){this.x=-1,this.y=8,this.dx=1,this.index=-1}NextMask(){var e;return this.index++,this.x<0?(this.dx=1,this.y=(8-this.y)%8,e=195):this.x>6?(this.dx=-1,this.y=7-this.y,e=216):e=o[this.y][this.x],this.x+=this.dx,32768===this.index||this.index>32768&&(this.index+1)%32768===0?this.NextMask():e}}},bd2e:function(e,t,a){"use strict";a.r(t),a.d(t,"CommonDecrypt",(function(){return c}));a("baa5");var r=a("1da1"),n=a("dde9"),i=a("b6cf"),o=a("fd2f"),l=a("7cc0"),s=a("a8ee");function c(e){return u.apply(this,arguments)}function u(){return u=Object(r["a"])((function*(e){var t,a=e.name.substring(e.name.lastIndexOf(".")+1,e.name.length).toLowerCase(),r=e.name.substring(0,e.name.lastIndexOf("."));switch(a){case"ncm":t=yield n.Decrypt(e.raw);break;case"mp3":case"flac":case"m4a":case"ogg":t=yield o.Decrypt(e.raw,r,a);break;case"tm0":case"tm3":t=yield o.Decrypt(e.raw,r,"mp3");break;case"qmc3":case"qmc0":case"qmcflac":case"qmcogg":case"tkm":case"bkcmp3":case"bkcflac":t=yield i.Decrypt(e.raw,r,a);break;case"mflac":t=yield l.Decrypt(e.raw,r,a);break;case"tm2":case"tm6":t=yield s.Decrypt(e.raw,r);break;default:t={status:!1,message:"不支持此文件格式"}}return t.status&&(t.rawExt=a,t.rawFilename=r),t})),u.apply(this,arguments)}},bfa2:function(e,t,a){var r=a("3d67"),n=["CommonDecrypt"];e.exports=function(){var e=new Worker(a.p+"ef9a6c5c80847514748f.worker.js",{name:"[hash].worker.js"});return r(e,n),e}},dde9:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return c}));a("e260"),a("fb6a"),a("ace4"),a("e6cf"),a("25f0"),a("5319"),a("5cc6"),a("b39a"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("3452"),i=a("7907"),o=a("06dc"),l=n.enc.Hex.parse("687a4852416d736f356b496e62617857"),s=n.enc.Hex.parse("2331346C6A6B5F215C5D2630553C2728");function c(e){return u.apply(this,arguments)}function u(){return u=Object(r["a"])((function*(e){var t=yield o.GetArrayBuffer(e),a=new DataView(t);if(1313166403!==a.getUint32(0,!0)||1296122950!==a.getUint32(4,!0))return{status:!1,message:"此ncm文件已损坏"};for(var r=m(a,t,10),n=p(r.data),i=h(a,t,r.offset),l=i.data,s=i.offset+a.getUint32(i.offset+5,!0)+13,c=new Uint8Array(t,s),u=0;u<c.length;++u)c[u]^=n[255&u];if(void 0===l.format){var[f,b,y,v]=c;l.format=102===f&&76===b&&97===y&&67===v?"flac":"mp3"}var g=o.AudioMimeType[l.format],w=[];l.artist.forEach(e=>{w.push(e[0])}),"mp3"===l.format&&(c=yield d(c,w,l.musicName,l.album,l.albumPic));var k=new Blob([c],{type:g}),_=URL.createObjectURL(k),x=w.join(" & ")+" - "+l.musicName+"."+l.format;return{status:!0,filename:x,title:l.musicName,artist:w.join(" & "),ext:l.format,album:l.album,picture:l.albumPic,file:_,mime:g}})),u.apply(this,arguments)}function d(e,t,a,r,n){return f.apply(this,arguments)}function f(){return f=Object(r["a"])((function*(e,t,a,r,n){var o=new i(e);if(o.setFrame("TPE1",t).setFrame("TIT2",a).setFrame("TALB",r),""!==n)try{var l=yield(yield fetch(n)).arrayBuffer();o.setFrame("APIC",{type:3,data:l,description:"Cover"})}catch(s){console.log("Fail to write cover image!")}return o.addTag(),o.arrayBuffer})),f.apply(this,arguments)}function m(e,t,a){var r=e.getUint32(a,!0);a+=4;var i=new Uint8Array(t,a,r).map(e=>100^e);a+=r;for(var o=n.AES.decrypt({ciphertext:n.lib.WordArray.create(i)},l,{mode:n.mode.ECB,padding:n.pad.Pkcs7}),s=new Uint8Array(o.sigBytes),c=o.words,u=o.sigBytes,d=0;d<u;d++)s[d]=c[d>>>2]>>>24-d%4*8&255;return{offset:a,data:s.slice(17)}}function p(e){for(var t=new Uint8Array(Array(256).keys()),a=e.length,r=0,n=0;n<256;n++)r=t[n]+r+e[n%a]&255,[t[n],t[r]]=[t[r],t[n]];return t.map((e,t,a)=>{t=t+1&255;var r=a[t],n=a[t+r&255];return a[r+n&255]})}function h(e,t,a){var r=e.getUint32(a,!0);if(a+=4,0===r)return{};var i=new Uint8Array(t,a,r).map(e=>99^e);a+=r;var o=n.AES.decrypt({ciphertext:n.enc.Base64.parse(n.lib.WordArray.create(i.slice(22)).toString(n.enc.Utf8))},s,{mode:n.mode.ECB,padding:n.pad.Pkcs7}),l=JSON.parse(o.toString(n.enc.Utf8).slice(6));return l.albumPic=l.albumPic.replace("http:","https:"),{data:l,offset:a}}},fd2f:function(e,t,a){"use strict";a.r(t),a.d(t,"Decrypt",(function(){return o}));a("e260"),a("ddb0"),a("2b3d");var r=a("1da1"),n=a("cb96"),i=a("06dc");function o(e,t,a){return l.apply(this,arguments)}function l(){return l=Object(r["a"])((function*(e,t,a){var r=yield n.parseBlob(e),o=URL.createObjectURL(e),l=i.GetCoverURL(r),s=i.AudioMimeType[a],c=i.GetFileInfo(r.common.artist,r.common.title,t,a);return{status:!0,filename:c.filename,title:c.title,artist:c.artist,ext:a,album:r.common.album,picture:l,file:o,mime:s}})),l.apply(this,arguments)}}});
//# sourceMappingURL=app.8f1e8173.js.map