<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="//"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=5,viewport-fit=cover"><meta name="renderer" content="webkit"><title>以 Google Analytics 实现的 PV 浏览量统计 | Lufs&#39;s Blog</title><link rel="icon" type="image&#x2F;ico" href="https://cdn.isteed.cc/favicon/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.isteed.cc/favicon/apple-touch-icon.png"><link rel="icon" typt="image&#x2F;png" sizes="192x192" href="https://cdn.isteed.cc/favicon/android-chrome-192x192.png"><link rel="icon" typt="image&#x2F;png" sizes="32x32" href="https://cdn.isteed.cc/favicon/favicon-32x32.png"><link rel="icon" typt="image&#x2F;png" sizes="16x16" href="https://cdn.isteed.cc/favicon/favicon-16x16.png"><link rel="mask-icon" href="https://cdn.isteed.cc/favicon/safari-pinned-tab.svg" color="rgba(241,249,250,1)"><meta name="theme-color" content="rgba(241,249,250,1)"><link rel="stylesheet" href="https://cdn.isteed.cc/file/spectre.min.css"><style>body{background-color:#f1f9fa}a,a:visited{color:#8f82bc}a:active,a:focus,a:hover{color:#8f82bc;opacity:.75}#post-content a,#post-content a:focus,#post-content a:hover,#post-content a:visited{color:#8f82bc;opacity:1}#post-content img.lazy{transition:filter .35s ease 0s}#post-content img.lazy:not(.loaded){visibility:hidden;-webkit-filter:blur(5px);filter:blur(5px)}#post-content img.lazy:not(.loaded):not(.loading){padding-bottom:68%}#post-content img.lazy.error{display:none}.post-entry .card-body a{color:#7065a3}.avatar{background:#7065a3}.navbar-link,.navbar-link:visited,.timeline .timeline-item .timeline-icon.icon-lg{color:#7065a3}.navbar-link:hover{color:#7065a3;opacity:.8}#disqus-loadmore-button,#disqus-switch-to-direct,#disqus_click_btn,#search-input .btn{background:#7065a3;border-color:#7065a3;color:#fff}#post-toc a.post-toc-link,#post-toc a.post-toc-link:visited,.share-menu.menu .menu-item>a{color:#7065a3}.share-menu.menu .menu-item>a:focus,.share-menu.menu .menu-item>a:hover,.share-menu.menu .menu-item>a:visited{color:#50596c;background:#f1f9fa;opacity:.85}</style><link rel="stylesheet" href="https://cdn.isteed.cc/file/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lufsx/res@0.1.4/file/disqusjs.min.css"></noscript><link rel="preload" href="https://cdn.isteed.cc/file/atom-one.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.isteed.cc/file/atom-one.min.css"></noscript><script>/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
!function(t){"use strict";t.loadCSS||(t.loadCSS=function(){});var e=loadCSS.relpreload={};if(e.support=function(){var e;try{e=t.document.createElement("link").relList.supports("preload")}catch(t){e=!1}return function(){return e}}(),e.bindMediaToggle=function(t){var e=t.media||"all";function a(){t.addEventListener?t.removeEventListener("load",a):t.attachEvent&&t.detachEvent("onload",a),t.setAttribute("onload",null),t.media=e}t.addEventListener?t.addEventListener("load",a):t.attachEvent&&t.attachEvent("onload",a),setTimeout((function(){t.rel="stylesheet",t.media="only x"})),setTimeout(a,3e3)},e.poly=function(){if(!e.support())for(var a=t.document.getElementsByTagName("link"),n=0;n<a.length;n++){var o=a[n];"preload"!==o.rel||"style"!==o.getAttribute("as")||o.getAttribute("data-loadcss")||(o.setAttribute("data-loadcss",!0),e.bindMediaToggle(o))}},!e.support()){e.poly();var a=t.setInterval(e.poly,500);t.addEventListener?t.addEventListener("load",(function(){e.poly(),t.clearInterval(a)})):t.attachEvent&&t.attachEvent("onload",(function(){e.poly(),t.clearInterval(a)}))}"undefined"!=typeof exports?exports.loadCSS=loadCSS:t.loadCSS=loadCSS}("undefined"!=typeof global?global:this)</script><meta name="google-site-verification" content="wk686q2aTrts7GR0yVJ7UrALaAodD62StMuSuH7dMOU"><meta name="mobile-web-app-capable" content="yes"><meta name="application-name" content="Lufs's Blog"><meta name="msapplication-starturl" content="https://blog.isteed.cc"><meta name="msapplication-navbutton-color" content="rgba(241,249,250,1)"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lufs's Blog"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="search" type="application/opensearchdescription+xml" href="/source/opensearch.xml" title="Lufs's Blog"><meta property="og:title" content="以 Google Analytics 实现的 PV 浏览量统计 | Lufs&#39;s Blog"><meta property="og:site_name" content="Lufs&#39;s Blog"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.isteed.cc/post/google-analytics-hit-count/"><meta property="og:locale" content="zh-CN"><meta name="description" content="浏览量统计有挺多种的，不乏像不蒜子、LeanCloud 等统计方式，但始终不能如意。 例如不蒜子无法导入&#x2F;修改数据，浏览量是通过 href 来统计的，对「镜像站」的不友好，以及 Safari 上的抽风… 又像 LeanCloud 的哪麻烦的设置与「缓慢」的 API… - Lufs - Lufs&#39;s Blog"><meta name="keywords" content="Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, 水怪"><meta property="og:image" content="https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp"><meta property="og:image" content="https://cdn.isteed.cc/img/google-analytics-hit-count/t01p.webp"><meta property="og:image" content="https://cdn.isteed.cc/img/google-analytics-hit-count/t02p.webp"><meta property="og:image" content="https://cdn.isteed.cc/img/google-analytics-hit-count/t03p.webp"><meta property="og:image" content="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.webp"><meta property="article:published_time" content="2020-06-26T17:06:57.000Z"><meta property="article:modified_time" content="2020-07-16T08:53:57.000Z"><meta property="og:updated_time" content="2020-07-16T08:53:57.000Z"><meta property="article:author" content="Lufs"><meta property="article:tag" content="Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, 水怪"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp"><link rel="canonical" href="https://blog.isteed.cc/post/google-analytics-hit-count/"><meta name="generator" content="Hexo 6.3.0"><script>!function(e,t,n,a,c,r,s){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},(r=t.createElement(a)).async=1,r.src="https://www.clarity.ms/tag/alejvn2b9x",(s=t.getElementsByTagName(a)[0]).parentNode.insertBefore(r,s)}(window,document,"clarity","script")</script><script type="application/ld+json">{
    "@context": "http://schema.org",
    "url": "https://blog.isteed.cc/post/google-analytics-hit-count/",
    "@type": "BlogPosting",
    "logo": "https://cdn.isteed.cc/favicon/android-chrome-192x192.png",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://blog.isteed.cc/post/google-analytics-hit-count/"
    },
    "headline": "以 Google Analytics 实现的 PV 浏览量统计 | Lufs&#39;s Blog",
    
    "image": {
        "@type": "ImageObject",
        "url": "https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp"
    },
    
    "datePublished": "2020-06-26T17:06:57.000Z",
    "dateModified": "2020-07-16T08:53:57.000Z",
    "author": {
        "@type": "Person",
        "name": "Lufs",
        "image": {
            "@type": "ImageObject",
            "url": "https://cdn.isteed.cc/avatar/avatar-48x48.webp"
        },
        "description": "Life feeds on negative entropy."
    },
    "publisher": {
        "@type": "Organization",
        "name": "Lufs&#39;s Blog",
        "logo": {
            "@type": "ImageObject",
            "url": "https://cdn.isteed.cc/favicon/android-chrome-192x192.png"
        }
    },
    
    "potentialAction": {
        "@type": "SearchAction",
        "target": "https://blog.isteed.cc/search?s={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    
    "keywords": "Google Analytics, Blog, Page View, Vercel, Lufs, Lufs Blog, Hexo, hexo, Android, blog, 水怪",
    "description": "浏览量统计有挺多种的，不乏像不蒜子、LeanCloud 等统计方式，但始终不能如意。 例如不蒜子无法导入/修改数据，浏览量是通过 href 来统计的，对「镜像站」的不友好，以及 Safari 上的抽风… 又像 LeanCloud 的哪麻烦的设置与「缓慢」的 API… - Lufs - Lufs&#39;s Blog"
}</script><link rel="stylesheet" href="https://cdn.isteed.cc/file/dark.min.css" media="(prefers-color-scheme:dark)" crossorigin><script>"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js").then((function(e){console.log("Yay! ServiceWorker is loaded 🎉")}),(function(e){console.log("Oh! ServiceWorker registration failed 😥")}))}))</script><script>console.log("\n %c Lufs's Blog %c https://blog.isteed.cc/ \n","color: #fff; background: #7065a3; padding:5px 0;","background: #f0fafb; padding:5px 0;"),console.log("%c ","background:url(data:image/png;base64,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) no-repeat center;background-size:200px;padding-left:200px;padding-bottom:162px;overflow:hidden;border-radius:10px;margin:5px 0")</script><link rel="alternate" href="/atom.xml" title="Lufs's Blog" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="Lufs's Blog" type="application/rss+xml"></head><body><header><h1 class="header-title text-center"><a href="/">Lufs&#39;s Blog</a></h1><p class="text-center header-slogan">Life feeds on negative entropy.</p><nav class="navbar-section text-center"><a href="/" class="navbar-link">首页</a> <a href="/archives/" class="navbar-link">归档</a> <a href="/search" class="navbar-link">搜索</a> <a href="/welfare/" class="navbar-link">福利</a> <a href="/post/about/" class="navbar-link">关于</a> <a target="_blank" rel="noopener" href="https://isteed.cc/friend" class="navbar-link">友链</a></nav></header><div class="post-container"><div id="post-card" class="card"><div class="card-image lazy" crossorigin data-bg="https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp"></div><div class="card-item-container"><div class="card-inner-cell"><div class="card-header"><h1 class="card-title h3 mb-2">以 Google Analytics 实现的 PV 浏览量统计</h1><div class="post-header-info"><p class="post-header-info-left text-gray"><img class="author-thumb lazy" data-src="https://cdn.isteed.cc/avatar/avatar-48x48.webp" src="https://cdn.isteed.cc/img/svg/loading.svg" alt="Lufs's Avatar"> <span>2020-06-27</span> <span class="suka-devide-dot"></span> <a class="category-link" href="/categories/%E5%88%86%E4%BA%AB/">分享</a></p><div class="post-header-info-right"><div class="dropdown dropdown-right"><a class="dropdown-toggle" tabindex="0">分享本文</a><ul class="menu share-menu"><li class="menu-item"><a href="http://service.weibo.com/share/share.php?appkey=&title=以 Google Analytics 实现的 PV 浏览量统计&url=https://blog.isteed.cc/post/google-analytics-hit-count/&pic=https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp&searchPic=false&style=simple" target="_blank" rel="external noopener noreferrer nofollow">分享到微博</a></li><li class="menu-item"><a href="http://connect.qq.com/widget/shareqq/index.html?site=Lufs's Blog&title=Lufs's Blog&summary=Life feeds on negative entropy.&pics=https://cdn.isteed.cc/img/google-analytics-hit-count/thumbnail.webp&url=https://blog.isteed.cc/post/google-analytics-hit-count/" target="_blank" rel="external noopener noreferrer nofollow">分享到 QQ</a></li><li class="menu-item"><a href="https://t.me/share/url?url=https://blog.isteed.cc/post/google-analytics-hit-count/&text=Lufs's Blog" target="_blank" rel="external noopener noreferrer nofollow">分享到 Telegram</a></li><li class="menu-item"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACUCAAAAABQV18IAAAB00lEQVR42u3by1LEMBBD0fz/T8N2oGzp9lQWsaJsKKgwPovGdj+4fh74XEUVVVRRC9Qlnt07fz7I/N5onaJiUMugAyjys/9f5TpFRaHUh62CV72ngn63TlHvQ60CVQUx/byi3omabqar74t6H0oFMb0ErmCjg7+oGJRa9M6vt2UzRT0aZYsOcHMlyeltVZeiHo1Sgeje2R3ENNCLykWpQ5Qcxrs/hN1BjS55RR2LIgC3QboLHSmcFJWFki+aRdXGSgofReWhSJHMJRIORDbUonJQu81uVyijRRDXILDJaFHHokhTmhzcbrN1zcui8lAKQjDkomjxRUWgpgUJUqx1DW9b3C/qaBQZxLKbHjjAv6q6FHUkiiSZJJhJAmuDvqgIFC1+uUKrujS6RmRRWSjadHSXQopTl8qiMlC0wUgvcAqjNumiclHqUiaDFA6rymS2qCgULXjRpPOboYmiMlG08aPQ00GLorJQZFDwgv+4gxZWyW1RESg6dEOLaJPBaNzFKuo4FElKCYQW80cHclHHomgTyC06aV4W9V4UuQjSAXo5PFbUa1CTQgXBjYZPizoW5Qbd8VCySR5GA81FHYuaFuZJA2iSmBaVhXrSU1RRRRX18fwCGRHSwuG6LdUAAAAASUVORK5CYII=" alt="QRCode"></li></ul></div></div></div></div><div class="card-body"><div id="post-toc"><ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%BC%80%E5%90%AF-Google-Analytics-API"><span class="post-toc-number">1.</span> <span class="post-toc-text">开启 Google Analytics API</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%83%A8%E7%BD%B2%E5%88%B0-Vercel"><span class="post-toc-number">2.</span> <span class="post-toc-text">部署到 Vercel</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E4%BF%AE%E6%94%B9-config-ts-%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">修改 config.ts 的配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%AF%BC%E5%85%A5-Vercel"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">导入 Vercel</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B0%83%E7%94%A8-API"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">调用 API</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E9%9B%86%E6%88%90%E5%88%B0-Hexo-%E4%B8%BB%E9%A2%98"><span class="post-toc-number">3.</span> <span class="post-toc-text">集成到 Hexo 主题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%9B%E5%BB%BA-EJS"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">创建 EJS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%BC%95%E5%85%A5-EJS"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">引入 EJS</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%A0%B8%E5%BF%83-js"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">核心 js</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E6%88%90%E6%9E%9C"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">成果</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%A2%8E%E7%A2%8E%E5%BF%B5"><span class="post-toc-number">4.</span> <span class="post-toc-text">碎碎念</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5-%E5%85%B3%E8%81%94%E9%98%85%E8%AF%BB"><span class="post-toc-number">5.</span> <span class="post-toc-text">参考链接&#x2F;关联阅读</span></a></li></ol></div><article id="post-content"><p>浏览量统计有挺多种的，不乏像不蒜子、LeanCloud 等统计方式，但始终不能如意。</p><p>例如不蒜子无法导入/修改数据，浏览量是通过 href 来统计的，对「镜像站」的不友好，以及 Safari 上的抽风…</p><p>又像 LeanCloud 的哪麻烦的设置与「缓慢」的 API…</p><span id="more"></span><p>最终都让我放弃，偶然在 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://printempw.github.io/google-analytics-api-page-views-counter/">PRIN BLOG</a> 发现可以利用 Google Analytics 的数据来进行浏览量，但需要部署在 VPS 上，见作者说部署到 Serverless 平台失败，就以为无法白嫖，直到 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://spencerwoo.com/">Spencer</a> 的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">这篇博文</a>出来。二话不说，开搞 😋！</p><hr><p>详细教程可以看<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">这篇博文</a>，这里就简单复述一下呢</p><h1 id="开启-Google-Analytics-API">开启 Google Analytics API</h1><p>可以按照 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developers.google.com/analytics/devguides/reporting/core/v4/quickstart/service-py#1_enable_the_api">Google 官方教程</a> 走，也可以直接按下面的步骤来。</p><hr><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://console.developers.google.com/start/api?id=analyticsreporting.googleapis.com&amp;credential=client_key">setup tools</a> 并根据提示进行设置，选择一个项目（或创建新的项目，比如 ga-hit-count），之后一路继续，就可以为我们这一项目开启 Google API 咯～</p><p><img src="https://cdn.isteed.cc/img/google-analytics-hit-count/t01p.webp" class="lazy" data-srcset="https://cdn.isteed.cc/img/google-analytics-hit-count/t01p.webp" srcset="https://cdn.isteed.cc/img/svg/loading.svg" alt="Credentials"></p><p>然后页面就会跳转到 Google API 的凭据设置页面，API 选择 <code>Analytics Reporting API</code>，调用方法选择 <code>网页服务器</code>，最后选择 <code>不会使用 App Engine 或 Compute Engine</code> 即可。</p><p><img src="https://cdn.isteed.cc/img/google-analytics-hit-count/t02p.webp" class="lazy" data-srcset="https://cdn.isteed.cc/img/google-analytics-hit-count/t02p.webp" srcset="https://cdn.isteed.cc/img/svg/loading.svg" alt="GetCredentials"></p><p>最后根据提示设置基本信息，例如设置服务账号名称（随意设置），选定「角色」为 <code>Service Account User</code>，按继续后就将会有一个 json 文件下载下来</p><p><img src="https://cdn.isteed.cc/img/google-analytics-hit-count/t03p.webp" class="lazy" data-srcset="https://cdn.isteed.cc/img/google-analytics-hit-count/t03p.webp" srcset="https://cdn.isteed.cc/img/svg/loading.svg" alt="GoogleAPIs"></p><p>json 文件长这样，需要的几个信息都在这儿了</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">&quot;project_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gmeta-domain&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private_key&quot;</span><span class="punctuation">:</span> <span class="string">&quot;-----BEGIN PRIVATE KEY-----\nxxx-----END PRIVATE KEY-----\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;client_email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blog-analytics@meta-domain.gserviceaccount.com&quot;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>要让 API 访问到 Google Analytics 的数据，需要打开 Google Analytics 后台将 client_email 定义的邮箱作为新用户加入，这里有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://support.google.com/analytics/answer/1009702">官方教程</a></p><p>记住，一定要保管好它们，不然丢了谁都不认你 🤪</p><h1 id="部署到-Vercel">部署到 Vercel</h1><p>这里是用 Vercel 来部署 Serverless API 项目，贴个大佬项目的原地址 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/spencerwooo/ga-hit-count-serverless">spencerwooo/ga-hit-count-serverless</a>，大家 Fork 下来修改下 <code>api/config.ts</code> 里的配置就可以用了</p><h2 id="修改-config-ts-的配置">修改 config.ts 的配置</h2><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Google Analytics query configurations</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ! If you are deploying this with your own account</span></span><br><span class="line"><span class="comment"> * ! , then you will need to change this config file.</span></span><br><span class="line"><span class="comment"> * ! Don&#x27;t put your privateKey inside this file directly!</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">viewId</span>: <span class="string">&quot;Google Analytics 视图 ID&quot;</span>,</span><br><span class="line">  <span class="attr">auth</span>: &#123;</span><br><span class="line">    <span class="attr">projectId</span>: <span class="string">&quot;Project ID&quot;</span>,</span><br><span class="line">    <span class="attr">privateKey</span>: process.<span class="property">env</span>.<span class="property">PRIVATE_KEY</span>,</span><br><span class="line">    <span class="attr">clientEmail</span>: <span class="string">&quot;blog-analytics@meta-domain.gserviceaccount.com&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">allFilter</span>: [<span class="string">&quot;/&quot;</span>],</span><br><span class="line">  <span class="attr">startDate</span>: <span class="string">&quot;2010-01-01&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这是配置文件的样子</p><hr><p>这里就直接引用<a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">原文</a>～（虽然本来就是与原文差不多的说</p><blockquote><p>其中，这些内容我们都需要一一进行设置：</p><ul><li><code>viewId</code>：是你的 Google Analytics 视图 ID，可以在 Google Analytics 后台的 Admin » View » View Settings 中找到；<br><img src="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.webp" class="lazy" data-srcset="https://i.loli.net/2020/06/25/VIWUvCqSyX23jed.webp" srcset="https://cdn.isteed.cc/img/svg/loading.svg" alt="Google Analytics 视图 ID 的设定位置"></li><li><code>projectId</code>：是刚刚凭证 JSON 文件中的 <code>project_id</code>，直接按照刚刚的凭证填写即可；</li><li><code>privateKey</code>：是通过 Vercel 环境变量获取到的 API 凭证私钥，<strong>这里不要更改</strong>；</li><li><code>clientEmail</code>：是刚刚凭证 JSON 文件中的 <code>client_email</code>，直接按照刚刚的凭证填写即可；</li><li><code>allFilter</code>：是通过 Google API 查询时的前缀过滤器，比如你的网站中文章路径以 <code>/post</code> 开头，那么就可以设置为 <code>['/post']</code>。默认为 <code>['/20']</code>（因为我的文章路径是以 <code>/2020</code> 或 <code>/2019</code> 开头的）；</li><li><code>startDate</code>：是通过 Google API 查询时设定时间段的开始时间，设定一个比较久远的时间即可，默认为 <code>2010-01-01</code>。</li></ul></blockquote><div class="toast toast-warning">🚨 请注意！<br>这里千万千万不要直接将刚刚凭证中获取到的私钥直接粘贴进入 privateKey 一项之中，因为这样当我们将 config.ts 签入 git 之后，privateKey 将以明文形式保存，非常危险。</div><h2 id="导入-Vercel">导入 Vercel</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.com/">Vercel</a>（这家伙又又又换名字了），用 GitHub 注册后，直接将刚刚 Fork 并修改好配置文件的项目导入即可，啥都不用管就是 <code>Continue</code></p><p>导入完成后还需要设置 <code>privateKey</code>，在项目的 <code>Project Settings</code> - <code>General</code> - <code>Environment Variables</code> - <code>Production</code> 中添加一个</p><ul><li><code>NAME</code> 为 <code>PRIVATE_KEY</code></li><li><code>VALUE</code> 为 <code>private_key</code><ul><li>这个 <code>private_key</code> 是上面的哪个 json 里的对应值，需要注意的是要把 <code>\n</code> 全部删除，换成换行（<kbd>command</kbd> + <kbd>D</kbd> 大胜利！）</li></ul></li></ul><p>的变量</p><p>最后需要重新触发一次部署，随便 commit 点东西更新一下就行啦</p><h2 id="调用-API">调用 API</h2><p>Vercel 应该会给你分配一个类似于 <code>https://xxxx.vercel.app</code> 的域名，在根域名后面添加 <code>/api/ga</code> 访问，看看是否会将 Google Analytics 里面全部路径与访问量拉取并以 JSON response 给出</p><p>这个请求方法是后面带个 <code>?page=&#123;WEBSITE_PAGE_PATH&#125;</code>，其中 <code>&#123;WEBSITE_PAGE_PATH&#125;</code> 是你博文的相对路径，这样就会返回给定路径的浏览量啦 😆</p><p>例如现在的这篇博文，相对路径是 <code>/posts/google-analytics-hit-count/</code>，那么请求的将是</p><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//</span>xxxx.vercel.app<span class="regexp">/api/g</span>a?page=<span class="regexp">/posts/g</span>oogle-analytics-hit-count/</span><br></pre></td></tr></table></figure><p>⚠️ 注意：我设置了自定义域名，访问的将是<a target="_blank" rel="noopener external nofollow noreferrer" href="https://api.isteed.cc/api/ga?page=/posts/google-analytics-hit-count/">这样</a>的（你可以点进去看看）</p><p>它就会返回数据给你，现在我这篇博文的浏览量是 <code>0</code>，返回的数据是下面这样的</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[&#123;<span class="string">&quot;page&quot;</span>:<span class="string">&quot;/posts/google-analytics-hit-count/&quot;</span>,<span class="string">&quot;hit&quot;</span>:<span class="string">&quot;0&quot;</span>&#125;]</span></span><br></pre></td></tr></table></figure><hr><p>原文有的就到这儿了，有了 API 那该怎么用呢？下面便是一个简单的使用方法</p><h1 id="集成到-Hexo-主题">集成到 Hexo 主题</h1><p>这下，API 有了，请求格式也有了，那么就可以将它集成在自己的主题里啦 😆</p><p>下面将以我现在使用的 Hexo 主题 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/hexo-theme-suka">hexo-theme-suka</a> 为例</p><p>这个简单的 js 就开源到 GitHub 上了，这里是地址 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/ga-hit-count">Lufsx/ga-hit-count</a>，之后会写点 README，最近在考试，没啥时间呢（<s>没啥时间搞这些？</s>）</p><p>现在的这个 js 有一些问题，但还用还是能用哒 🤣（有时间再完善呢</p><h2 id="创建-EJS">创建 EJS</h2><p>首先根据原主题的规范，在 <code>/layout/_plugin/</code> 新建了个文件夹，用于存放所需要用到的 EJS 文件</p><p>接下来就是新建文件啦 🤪</p><p>先给它新建个 <code>import_js.ejs</code> 用来在头部引入 <code>js</code> 文件，传递一个已经搭建好的 API 地址的参数</p><p>下面是代码呢（菜鸡一个，如果有更好的写法，欢迎提出呀 🤣）</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">post_views_api</span> = <span class="string">&quot;&lt;%= theme.ga_hit_count.post_views_api %&gt;&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;% <span class="keyword">if</span> (theme.<span class="property">vendors</span>.<span class="property">ga_hit_count</span>) &#123; %&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&lt;%= theme.vendors.ga_hit_count %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; <span class="keyword">else</span> &#123; %&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/ga-views.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>前面四行是定义了一个变量 <code>window.post_views_api</code>，值为主题配置文件中</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">post_views_api:</span> <span class="comment"># 是这里的值呀</span></span><br></pre></td></tr></table></figure><p>它传递了你 API 所在的地址</p><p>后面的五行则是引入了 js 文件，顺便判断了下有无自定义 js 地址，没有就返回内置的，这个自定义地址在主题配置文件中长这样</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="attr">ga_hit_count:</span> <span class="comment"># 这里就是自定义的地址呢</span></span><br></pre></td></tr></table></figure><hr><p>接着在同目录下创建个 <code>post-counter.ejs</code></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;!-- <span class="variable constant_">GA</span> <span class="title class_">Hit</span> <span class="title class_">Count</span> <span class="title class_">Post</span> <span class="title class_">Views</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;post-meta-views&quot;</span> <span class="attr">hidden</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;suka-devide-dot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&lt;%- theme.ga_hit_count.before %&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;pv-counter&quot;</span>&gt;</span>loading<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&lt;%- theme.ga_hit_count.after %&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>这里是直接复制主题带的另外一个浏览量统计的（懒</p><p>定义了一个 id 为 <code>post-meta-views</code> 的 <code>&lt;span&gt;</code> 包裹着 <code>pv-counter</code> 的 <code>&lt;span&gt;</code></p><h2 id="引入-EJS">引入 EJS</h2><p>全局引入的 EJS 文件是这个 <code>/layout/_partial/source/footer.ejs</code></p><p>简单添加几句直接带走</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+    /* GA Hit Count */</span></span><br><span class="line"><span class="addition">+    if (theme.ga_hit_count.enable) html += partial(&#x27;_plugin/hit-count/import_js&#x27;);</span></span><br></pre></td></tr></table></figure><p>这里判断主题文件中的 <code>enable</code> 值是否为 <code>true</code>，是则引入 <code>_plugin/hit-count/import_js</code></p><hr><p>我主题在博文页面引入统计所用的 EJS 文件是这个 <code>/layout/_partial/post/header-info.ejs</code></p><p>简单添加几句再次带走 😆</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="addition">+        &lt;% if ( (theme.ga_hit_count.enable) ) &#123; %&gt;</span></span><br><span class="line"><span class="addition">+            &lt;%- partial(&#x27;_plugin/hit-count/post-counter&#x27;, &#123;&#125;, &#123;cache: theme.fragment_cache&#125;) %&gt;</span></span><br><span class="line"><span class="addition">+        &lt;% &#125; %&gt;</span></span><br></pre></td></tr></table></figure><p>这里判断主题文件中的 <code>enable</code> 值是否为 <code>true</code>，是则引入 <code>_plugin/hit-count/post-counter</code></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 是看这里是不是 true 呢</span></span><br></pre></td></tr></table></figure><h2 id="核心-js">核心 js</h2><p>引入都搞好啦，那么最核心的地方就是编写 js 了（虽然没啥技术含量，还实现的不太完美）</p><p>js 文件开源在 GitHub 上，这里是地址 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Lufsx/ga-hit-count">Lufsx/ga-hit-count</a></p><p>相关作用与解释直接打注释上了（懒～</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 找到 id 为 pv-counter 的</span></span><br><span class="line">  <span class="keyword">var</span> obj = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;pv-counter&quot;</span>);</span><br><span class="line">  <span class="comment">// 同上</span></span><br><span class="line">  <span class="keyword">var</span> show = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;post-meta-views&quot;</span>);</span><br><span class="line">  <span class="comment">// 获取 URL</span></span><br><span class="line">  <span class="keyword">var</span> url = <span class="variable language_">document</span>.<span class="property">location</span>.<span class="title function_">toString</span>();</span><br><span class="line">  <span class="keyword">var</span> arrUrl = url.<span class="title function_">split</span>(<span class="string">&quot;//&quot;</span>);</span><br><span class="line">  <span class="keyword">var</span> start = arrUrl[<span class="number">1</span>].<span class="title function_">indexOf</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">  <span class="comment">// 截取 URL 中，从第一个 / 开始的地址</span></span><br><span class="line">  <span class="keyword">var</span> relUrl = arrUrl[<span class="number">1</span>].<span class="title function_">substring</span>(start);</span><br><span class="line">  <span class="comment">// 如果相对地址中带有参数，那么截掉</span></span><br><span class="line">  <span class="comment">//例如微信打开的东西后面都会带一串炒鸡长的参数</span></span><br><span class="line">  <span class="keyword">if</span> (relUrl.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">    relUrl = relUrl.<span class="title function_">split</span>(<span class="string">&quot;?&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 从 API 获取数据</span></span><br><span class="line">  <span class="keyword">const</span> json = <span class="keyword">await</span> <span class="title function_">fetch</span>(</span><br><span class="line">    <span class="string">`<span class="subst">$&#123;<span class="variable language_">window</span>.post_views_api&#125;</span>?page=<span class="subst">$&#123;relUrl&#125;</span>`</span></span><br><span class="line">  ).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line">  <span class="comment">// 赋值 hit 为浏览量</span></span><br><span class="line">  <span class="keyword">const</span> hit = json[<span class="number">0</span>].<span class="property">hit</span>;</span><br><span class="line">  <span class="comment">// 如果 hit 不是未定义，存在 id 为 post-meta-views</span></span><br><span class="line">  <span class="keyword">if</span> (hit !== <span class="literal">undefined</span> &amp;&amp; show !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 那么将 id 为 pv-counter 的内容替换为浏览量</span></span><br><span class="line">    obj.<span class="property">innerHTML</span> = <span class="string">`<span class="subst">$&#123;hit&#125;</span>`</span>;</span><br><span class="line">    <span class="comment">// 并将它可见</span></span><br><span class="line">    show.<span class="property">hidden</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>js 的效果大概就是获取浏览量，获取完成后写入，再将元素设置为可见</p><h2 id="成果">成果</h2><p>最后，主题配置文件是这样子的</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">ga_hit_count:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">post_views_api:</span> <span class="string">https://api.isteed.cc/api/ga</span> <span class="comment"># Example: https://domain.com/api/ga</span></span><br><span class="line">  <span class="attr">before:</span> <span class="comment"># html tag support</span></span><br><span class="line">  <span class="attr">after:</span> <span class="string">Views</span> <span class="comment"># html tag support</span></span><br><span class="line"><span class="attr">vendors:</span></span><br><span class="line">  <span class="attr">ga_hit_count:</span> <span class="comment"># 这里就是自定义的地址呢</span></span><br></pre></td></tr></table></figure><hr><p>最终效果就如你现在浏览的这一篇博文一样呢</p><h1 id="碎碎念">碎碎念</h1><p>终于又重上了浏览量统计啦</p><p>这个东西的好处就是直接使用 Google Analytics 数据，一个 Google Analytics 统计代码通吃</p><p>但数据更新不太及时呢，而且原 Google Analytics 又特别阻碍页面的加载，不过还好，可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/SukkaW/cloudflare-workers-async-google-analytics">SukkaW/cloudflare-workers-async-google-analytics</a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/giuem/ga-proxy">giuem/ga-proxy</a> 等解决方案</p><hr><p>什么？你问我 macOS 应用推荐第二期去哪儿了？当然是咕了 🤪</p><p>不过已经在写了（指新建文件</p><h1 id="参考链接-关联阅读">参考链接/关联阅读</h1><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://printempw.github.io/google-analytics-api-page-views-counter/">PRIN BLOG</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://blog.spencerwoo.com/2020/06/serverless-ga-hit-count-api/">Spencer’s Blog</a></p></article><blockquote class="post-license"><p><strong>本文作者&nbsp;:&nbsp;Lufs</strong><br><strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载和引用时请注意遵守协议！</strong><br><strong>本文链接&nbsp;:&nbsp;</strong><a href="https://blog.isteed.cc/post/google-analytics-hit-count/">https://blog.isteed.cc/post/google-analytics-hit-count/</a></p></blockquote><blockquote id="date-expire-notification" class="post-expired-notify">本文最后更新于 <span id="date-expire-num"></span> 天前，文中所描述的信息可能已发生改变</blockquote><script>!function(){var e=Date.parse("2020-07-16"),t=(new Date).getTime()-e,n=Math.floor(t/864e5);n>=120?document.getElementById("date-expire-num").innerHTML=n:document.getElementById("date-expire-notification").style.display="none"}()</script><p class="post-footer-info mb-0 pt-0">本文发表于&nbsp;<time datetime="2020-06-26T17:06:57.000Z" itemprop="datePublished">2020-06-27</time> , 最后修改于&nbsp;<time datetime="2020-07-16T08:53:57.000Z" itemprop="dateModified">2020-07-16</time></p><p class="post-footer-info mb-0 pt-2"><span class="post-categories-list mt-2"><a class="post-categories-list-item" href="/categories/%E5%88%86%E4%BA%AB/">分享</a> </span><span class="post-tags-list mt-2"><a class="post-tags-list-item" href="/tags/Google-Analytics/" rel="tag">#&nbsp;Google Analytics</a> <a class="post-tags-list-item" href="/tags/Blog/" rel="tag">#&nbsp;Blog</a> <a class="post-tags-list-item" href="/tags/Page-View/" rel="tag">#&nbsp;Page View</a> <a class="post-tags-list-item" href="/tags/Vercel/" rel="tag">#&nbsp;Vercel</a></span></p></div><div class="post-nav px-2 bg-gray"><ul class="pagination"><li class="page-item page-prev"><a href="/post/macos-software/" rel="prev"><div class="page-item-title"><i class="icon icon-back" aria-hidden="true"></i></div><div class="page-item-subtitle">「Mac 的本领，突飞猛进。」 —— macOS 应用推荐第二期</div></a></li><li class="page-item page-next"><a href="/post/how-to-go-tg/" rel="next"><div class="page-item-title"><i class="icon icon-forward" aria-hidden="true"></i></div><div class="page-item-subtitle">优秀、轻快、安全的即时通讯 —— Telegram 入坑指南</div></a></li></ul></div><div class="card-footer post-comment"><div id="disqus_thread"></div><script id="js-disqusjs" src="https://cdn.isteed.cc/file/disqus.js" async></script><script>document.getElementById("js-disqusjs").addEventListener("load",(function(){function t(){new DisqusJS({shortname:"lufss-blog",siteName:"Lufs&#39;s Blog",identifier:"https://blog.isteed.cc/post/google-analytics-hit-count/",url:"https://blog.isteed.cc/post/google-analytics-hit-count/",api:"https://api.isteed.cc/disqus/",apikey:"f8sCuFyS82pto94gZ0V4xtPbYZlLej6xVCTPNyZ0CXlfZz25L8lqsnsxYVCPDhzc",admin:"Lufs_x"})}"complete"===document.readyState?t():window.addEventListener("load",t)}))</script></div></div></div></div></div><footer class="text-center"><p class="footer-copyright mb-0">Copyright&nbsp;©&nbsp;<span id="copyright-year"></span> <a class="footer-copyright-a" href="https://blog.isteed.cc">Lufs's Blog</a></p><p class="footer-text mb-0"><a href="/rss2.xml"><img alt="RSS" src="https://cdn.isteed.cc/img/svg/subscribe-via-rss.svg"></a></p><p class="footer-develop mb-0">Powered by&nbsp;<a href="https://hexo.io" target="_blank" class="footer-develop-a" rel="external nofollow noopener noreferrer">Hexo</a><span class="footer-develop-divider"></span>Theme&nbsp;-&nbsp;<a href="https://github.com/SukkaW/hexo-theme-suka" target="_blank" class="footer-develop-a" rel="external noopener">Suka</a></p></footer><script>window.lazyLoadOptions={elements_selector:".lazy",threshold:50},function(){var e=(new Date).getFullYear(),o=document.getElementById("copyright-year");o.textContent=2018===e?e:"2018 - "+e}(),console.log("\n %c Suka Theme (hexo-theme-suka) | © SukkaW | Verision 1.3.3 %c https://github.com/SukkaW/hexo-theme-suka \n","color: #fff; background: #444; padding:5px 0;","background: #bbb; padding:5px 0;")</script><script src="https://cdn.isteed.cc/file/lazyload.iife.min.js" async></script></body></html>